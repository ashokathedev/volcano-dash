<!-- ==================== JavaScript Section ==================== -->
<script>
  // Add at the top of the script section
  let currentPlayerName = '';  // Track current player's name
  let currentPlayerId = null;  // Track current player's ID
  let playerNickname = '';

  // Make requestPartner globally available but use hytopia through the proper channel
  window.requestPartner = function(id, name) {
    // Use the global hytopia object's sendData method
    hytopia.sendData({
      type: 'requestPartner',
      targetId: id
    });
    
    const statusEl = document.getElementById('selectionStatus');
    if (statusEl) {
      statusEl.textContent = `Request sent to ${name}...`;
      statusEl.className = 'selection-status pending';
    }
  };

  // Single onData handler for all game events

  hytopia.onData((data) => {

    // Handle initial state
    if (data.type === 'initialState') {
      currentPlayerName = data.playerName;
      currentPlayerId = data.playerId;
      updateLeaderboards(data.lastShiftLeaders, data.allTimeLeaders);
    }

    // Handle game start
    if (data.type === 'gameStart') {
      const bottomUI = document.querySelector('.bottom-ui-container');
      if (bottomUI) {
        bottomUI.style.display = 'flex';
      }
      // Hide partner selection UI
      const partnerSelectionUI = document.getElementById('partnerSelectionUI');
      if (partnerSelectionUI) {

        // Add fade-out class

        partnerSelectionUI.classList.add('fade-out');
        
        // Remove from DOM after fade completes
        setTimeout(() => {
          partnerSelectionUI.style.display = 'none';
          partnerSelectionUI.classList.remove('fade-out');
        }, 500);
      }
    }

    // Handle game end
    if (data.type === 'gameEnd') {
      const bottomUI = document.querySelector('.bottom-ui-container');
      if (bottomUI) {
        bottomUI.style.display = 'none';
      }
    }

    // Handle name confirmation
    if (data.type === 'nameSet') {
      currentPlayerName = data.name;
      currentPlayerId = data.playerId;    

    }

    // Handle player state updates

    if (data.type === 'updatePlayerState') {
      var heatBar = document.getElementById('heatBar');
      var heatPercent = (data.heatLevel / 1000) * 100;
      heatBar.style.width = heatPercent + '%';
      heatBar.style.backgroundColor = heatPercent > 75 ? '#ff0000' : 
                                    heatPercent > 50 ? '#ff6600' : '#ffaa00';

      document.getElementById('lavaOverlay').style.opacity = data.inLava ? '0.4' : '0';
      document.getElementById('currentScore').textContent = formatScore(data.score);
      document.getElementById('personalBestScore').textContent = formatScore(data.topScore);
      
      // Update leaderboards if included
      if (data.lastShiftLeaders && data.allTimeLeaders) {
        updateLeaderboards(data.lastShiftLeaders, data.allTimeLeaders);
      }
      
      // Update teleport charges with explicit check
      const teleportChargesElement = document.getElementById('teleportCharges');
      if (teleportChargesElement) {
        teleportChargesElement.textContent = data.teleportCharges;  
      }

      // Update currentPlayerName if included in state update
      if (data.playerName) {
        currentPlayerName = data.playerName;
      }
    }

    // Handle countdown updates

    if (data.type === 'countdownUpdate') {
      var messageEl = document.getElementById('countdownMessage');
      if (!messageEl) return;
      
      if (data.seconds <= 0) {
        messageEl.classList.remove('visible');
        messageEl.textContent = '';
        // Ensure it's hidden after fade
        setTimeout(() => {
          messageEl.style.display = 'none';
        }, 2000);
      } else {
        messageEl.style.display = 'block';
        messageEl.textContent = `Shift Starting in ${data.seconds} Seconds`;
        messageEl.classList.add('visible');
        
        // Add fade out for last 2 seconds
        if (data.shouldFade) {
          messageEl.style.opacity = '0';
          messageEl.style.transition = 'opacity 2s';
        } else {
          messageEl.style.opacity = '1';
          messageEl.style.transition = 'opacity 0.5s';
        }
      }
    }

    // Handle supercharge states

    if (data.type === 'superChargeState') {
      const superChargeUI = document.getElementById('superChargeUI');
      const chargeBar = document.getElementById('chargeBar');
      const chargeFill = chargeBar.querySelector('.charge-fill');
      const superChargePrompt = document.getElementById('superChargePrompt');

      switch(data.state) {
        case 'enter':
          superChargeUI.style.display = 'block';
          chargeBar.style.display = 'none';
          superChargePrompt.textContent = 'Hold F to super charge your energy!';
          break;
          
        case 'charging':
          superChargeUI.style.display = 'block';
          chargeBar.style.display = 'block';
          chargeFill.style.width = `${data.progress}%`;
          superChargePrompt.textContent = 'Hold F Until Complete!';
          break;
          
        case 'reset':
          chargeBar.style.display = 'none';
          chargeFill.style.width = '0%';
          superChargePrompt.textContent = 'Oh No! You let go!';
          setTimeout(() => {
            superChargePrompt.textContent = 'Hold F to Super Charge your Energy';
          }, 1000);
          break;
          
        case 'complete':
          chargeBar.style.display = 'none';
          superChargePrompt.textContent = 'Super Charge Successful!';
          setTimeout(() => {
            superChargeUI.style.display = 'none';
          }, 2000);
          break;
          
        case 'exit':
          superChargeUI.style.display = 'none';
          break;

        case 'alreadyUsed':
          superChargeUI.style.display = 'block';
          chargeBar.style.display = 'none';
          superChargePrompt.textContent = 'Already used this Super Charge!';
          setTimeout(() => {
            superChargeUI.style.display = 'none';
          }, 2000);
          break;
      }
    }

    // Handle leaderboard updates

    if (data.type === 'updateLeaderboards') {
      updateLeaderboards(data.lastShiftLeaders, data.allTimeLeaders);
    }

    if (data.type === 'heatClusterStatus') {
      const notification = document.getElementById('heatClusterNotification');
      
      if (data.active) {
        notification.textContent = data.message;
        notification.classList.add('active');
      } else {
        notification.classList.remove('active');
      }
    }

    if (data.type === 'partnerSelection') {
      const partnerUI = document.getElementById('partnerSelectionUI');
      const partnerList = document.getElementById('partnerList');
      const statusEl = document.getElementById('selectionStatus');
      
      // Clear any existing status messages
      if (statusEl) {
        statusEl.textContent = '';
        statusEl.className = 'selection-status';
      }
      
      // Show the partner selection UI
      partnerUI.style.display = 'block';
      partnerUI.classList.remove('fade-out');
      
      // Hide any existing partner info
      const partnerInfo = document.getElementById('partnerInfo');
      if (partnerInfo) {
        partnerInfo.style.display = 'none';
        partnerInfo.querySelector('.partner-name').textContent = '';
      }
      
      if (!data.availablePlayers || data.availablePlayers.length === 0) {
        partnerList.innerHTML = '<div class="no-partners">Waiting for other players to join...</div>';
      } else {
        partnerList.innerHTML = data.availablePlayers
          .map(player => `
            <div class="partner-option" onclick="requestPartner(${player.id}, '${player.name.replace(/'/g, "\\'")}')">
              <div class="player-name">${player.name}</div>
            </div>
          `).join('');
      }
    }

    if (data.type === 'partnerRequest') {
      const pendingRequest = document.getElementById('pendingRequest');
      const message = pendingRequest.querySelector('.request-message');
      
      message.textContent = `${data.fromName} wants to be your partner!`;
      pendingRequest.style.display = 'block';

      // Setup response buttons
      pendingRequest.querySelector('.accept-btn').onclick = () => {
        hytopia.sendData({
          type: 'respondToPartnerRequest',
          accepted: true
        });
        pendingRequest.style.display = 'none';
      };

      pendingRequest.querySelector('.reject-btn').onclick = () => {
        hytopia.sendData({
          type: 'respondToPartnerRequest',
          accepted: false
        });
        pendingRequest.style.display = 'none';
      };
    }

    if (data.type === 'partnerRequestFailed') {
      const statusEl = document.getElementById('selectionStatus');
      statusEl.textContent = data.message;
      statusEl.className = 'selection-status error';
      setTimeout(() => {
        statusEl.textContent = '';
        statusEl.className = 'selection-status';
      }, 3000);
    }

    if (data.type === 'partnershipFormed') {
      const partnerUI = document.getElementById('partnerSelectionUI');
      const confirmationEl = document.getElementById('partnershipConfirmation');
      const confirmMessageEl = confirmationEl.querySelector('.confirmation-message');
      
      // Show confirmation message
      confirmMessageEl.textContent = `Partnership formed with ${data.player2}!`;
      confirmationEl.style.display = 'block';
      
      // Hide confirmation after animation
      setTimeout(() => {
        confirmationEl.style.display = 'none';
      }, 3000);
      
      // Hide selection UI with fade
      partnerUI.classList.add('fade-out');
      setTimeout(() => {
        partnerUI.style.display = 'none';
        partnerUI.classList.remove('fade-out');
        hytopia.sendData({ type: 'lockPointer' });
      }, 500);
    }

    if (data.type === 'partnerRequestRejected') {
      const statusEl = document.getElementById('selectionStatus');
      statusEl.textContent = `${data.playerName} declined your partnership request`;
      statusEl.className = 'selection-status error';
      setTimeout(() => {
        statusEl.textContent = '';
        statusEl.className = 'selection-status';
      }, 3000);
    }

    if (data.type === 'teleportStatus') {
      const messageUI = document.getElementById('teleportMessageUI');
      const messagePrompt = document.getElementById('teleportMessagePrompt');
      
      messageUI.style.display = 'block';
      messagePrompt.textContent = data.message;
      
      // Hide the message after 2 seconds
      setTimeout(() => {
        messageUI.style.display = 'none';
      }, 2000);
    }
  });

  // Helper functions

  function formatScore(score) {
    return score.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  }

  // Template registrations

  hytopia.registerSceneUITemplate('join-npc-message', () => {
    return document.getElementById('join-npc-message').content.cloneNode(true);
  });

  hytopia.registerSceneUITemplate('practice-npc-message', () => {
    return document.getElementById('practice-npc-message').content.cloneNode(true);
  });

  hytopia.registerSceneUITemplate('player-queued', () => {
    return document.getElementById('player-queued').content.cloneNode(true);
  });

  // Add a helper function to update leaderboards
  function updateLeaderboards(lastShiftLeaders, allTimeLeaders) {
    
    const lastShiftList = document.getElementById('lastShiftLeaders');
    const allTimeList = document.getElementById('allTimeLeaders');
    
    if (lastShiftLeaders && lastShiftLeaders.length > 0) {
      lastShiftList.innerHTML = lastShiftLeaders
        .map((entry, index) => `
          <div class="leaderboard-entry ${entry.name === currentPlayerName ? 'current-player' : ''}">
            <span class="name">${index + 1}. ${entry.name}</span>
            <span class="score">${formatScore(entry.score)}</span>
          </div>
        `).join('');
    } else {
      lastShiftList.innerHTML = '<div class="leaderboard-entry">No scores yet</div>';
    }
    
    if (allTimeLeaders && allTimeLeaders.length > 0) {
      allTimeList.innerHTML = allTimeLeaders
        .map((entry, index) => `
          <div class="leaderboard-entry ${entry.name === currentPlayerName ? 'current-player' : ''}">
            <span class="name">${index + 1}. ${entry.name}</span>
            <span class="score">${formatScore(entry.score)}</span>
          </div>
        `).join('');
    } else {
      allTimeList.innerHTML = '<div class="leaderboard-entry">No scores yet</div>';
    }
  }

  // Add debug logging
  const originalSendData = hytopia.sendData;
  hytopia.sendData = function(data) {
    originalSendData.call(this, data);
  };

  const originalOnData = hytopia.onData;
  hytopia.onData = function(callback) {
    originalOnData.call(this, (data) => {
      callback(data);
    });
  };

  function selectPartner(partnerId) {
    hytopia.sendData({
      type: 'selectPartner',
      partnerId
    });
  }

  // Update the submitName function to lock pointer after submission
  window.submitName = function() {
    console.log('submitName function called');
    const nameInput = document.getElementById('nameInput');
    const welcomeScreen = document.getElementById('welcomeScreen');
    const name = nameInput?.value.trim();
    if (name) {
      console.log('Submitting name:', name);
      playerNickname = name;
      
      // Hide welcome screen with fade out
      if (welcomeScreen) {
        welcomeScreen.style.opacity = '0';
        welcomeScreen.style.transition = 'opacity 0.5s';
        
        // Remove from DOM after fade and lock pointer
        setTimeout(() => {
          welcomeScreen.style.display = 'none';
          hytopia.lockPointer();  // Lock pointer after welcome screen is gone
        }, 500);
      }
      
      // Send the nickname to the server
      hytopia.sendData({
        type: 'setNickname',
        nickname: name
      });
    }
  };

  // Add this near the top of the script section with other window assignments
  window.handleEnterKey = function(e) {
    if (e.key === 'Enter') {
      e.preventDefault(); // Prevent default Enter behavior
      submitName();
    }
  };

  document.addEventListener('DOMContentLoaded', () => {
    const nameInput = document.getElementById('nameInput');
    const submitButton = document.getElementById('submitName');
    const welcomeScreen = document.getElementById('welcomeScreen');

    // Focus the input when the page loads
    nameInput?.focus();

    // Click anywhere to focus input
    welcomeScreen?.addEventListener('click', () => {
      nameInput?.focus();
    });

    // Update button style based on input
    nameInput?.addEventListener('input', () => {
      if (submitButton) {
        submitButton.style.opacity = nameInput.value.trim() ? '1' : '0.5';
      }
    });

    // Initialize button style
    if (submitButton) {
      submitButton.style.opacity = '0.5';
    }
  });
</script>

<!-- ==================== HTML Section ==================== -->

<div id="welcomeScreen" class="welcome-screen">
  <div class="welcome-content">
    <h1>Welcome to Volcano Dash!</h1>
    <p>Work shifts absorbing energy from the lava chamber. Be careful not to overheat!</p>
    <div class="name-input-container">
      <input type="text" id="nameInput" class="name-input" placeholder="Enter Name" maxlength="20" onKeyPress="handleEnterKey(event)">
      <button id="submitName" class="submit-button" onClick="submitName()">Press Enter to Start</button>
    </div>
  </div>
</div>

<!-- Game UI -->

<div id="game-ui">
  <!-- Stats Container -->
  <div class="stats-container">
    <!-- Remove this section
    <div class="game-stat teleport-info">
      <span class="stat-label">Teleport Charges:</span>
      <span id="teleportCharges" class="stat-value">0</span>
    </div>
    -->
  </div>

  <!-- Leaderboards -->
  <div class="leaderboards-container">
    <div class="best-shift-box">
      <div class="leaderboard-title">Your Best Shift</div>
      <div id="personalBestScore" class="score-value">0</div>
    </div>
    <div class="leaderboard-box">
      <div class="leaderboard-title">Last Shift Leaders</div>
      <div id="lastShiftLeaders" class="leaderboard-list"></div>
    </div>
    <div class="leaderboard-box">
      <div class="leaderboard-title">All Time Leaders</div>
      <div id="allTimeLeaders" class="leaderboard-list"></div>
    </div>
  </div>

  <!-- Bottom UI container -->
  <div class="bottom-ui-container">
    <div class="score-box">
      <div class="score-label">Energy Absorbed</div>
      <div class="score-value" id="currentScore">0</div>
    </div>

    <div class="heat-container">
      <div class="heat-label">Heat Level</div>
      <div class="heat-bar-wrapper">
        <div id="heatBar" class="heat-bar"></div>
      </div>
    </div>

    <div class="teleport-box">
      <div class="teleport-info">
        <div class="teleport-label">Teleport Charges [Q]</div>
        <div class="teleport-value" id="teleportCharges">0</div>
      </div>
    </div>
  </div>

  <!-- Move countdown message outside the center container -->
  <div id="countdownMessage" class="countdown-message"></div>

  <!-- Keep the center container for partner-related UI -->
  <div id="centerContainer" class="center-container">
    <!-- Partner Selection -->
    <div id="partnerSelectionUI" class="center-panel partner-selection" style="display: none;">
      <div class="partner-selection-content">
        <h2>Choose Your Partner</h2>
        <p>Select someone to team up with for this shift. Partners can teleport to each other during the game.</p>
        <div id="partnerList" class="partner-list"></div>
        <div id="selectionStatus" class="selection-status"></div>
        <div id="pendingRequest" class="pending-request" style="display: none;">
          <div class="request-message"></div>
          <div class="request-buttons">
            <button class="accept-btn">Accept</button>
            <button class="reject-btn">Decline</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Partnership Confirmation -->
    <div id="partnershipConfirmation" class="center-panel partnership-confirmation" style="display: none;">
      <div class="confirmation-message"></div>
    </div>
  </div>

  <div id="lavaOverlay" class="lava-overlay"></div>

  <div id="teleportStatus" class="teleport-status"></div>

  <div id="partnerInfo" class="partner-info" style="display: none;">
    <div class="partner-name"></div>
    <div class="teleport-charges"></div>
  </div>

  <!-- Move this element outside any containers that might be hidden -->
  <div id="countdown" class="countdown"></div>
</div>

<!-- Super Charge UI -->

<div id="superChargeUI">
  <div id="superChargePrompt">Press F to Super Charge your Energy</div>
  <div id="chargeBar">
    <div class="charge-fill"></div>
  </div>
</div>

<!-- Add this after the superChargeUI div -->
<div id="teleportMessageUI" class="teleport-message">
  <div id="teleportMessagePrompt"></div>
</div>

<!-- Templates -->

<template id="join-npc-message">
  <div class="join-npc-message">
    <h1>Join the Next Shift!</h1>
    <p>Come close to me to grab your gear</p>
    <p class="controls">(WASD to move, Spacebar to jump)</p>
  </div>
</template>

<template id="practice-npc-message">
  <div class="join-npc-message">
    <h1>Practice Room ==></h1>
    <p>Head this way to practice!</p>
    <p class="controls">(WASD to move, Spacebar to jump)</p>
  </div>
</template>

<template id="player-queued">
  <div class="queued-message">
    <p style="color: #00FF00;">Ready for next shift!</p>
  </div>
</template>

<!-- Heat Cluster Notification -->
<div id="heatClusterNotification" class="heat-cluster-notification"></div>

<!-- ==================== CSS Section ==================== -->
<style>

  /* Welcome Screen Styles */

  .welcome-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    transition: opacity 0.5s;
  }

  .welcome-content {
    background: rgba(0, 0, 0, 0.7);
    padding: 40px;
    border-radius: 15px;
    text-align: center;
    color: #fff;
    border: 2px solid #ff6600;
    max-width: 500px;
    pointer-events: auto;
  }

  .welcome-content h1 {
    color: #ff6600;
    margin-bottom: 20px;
    font-size: 32px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
  }

  .welcome-content p {
    margin-bottom: 30px;
    line-height: 1.6;
    font-size: 18px;
    color: #eee;
  }

  .name-input-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
  }

  .name-input {
    padding: 12px 20px;
    border-radius: 8px;
    border: 2px solid #ff6600;
    background: rgba(0, 0, 0, 0.3);
    color: white;
    width: 250px;
    text-align: center;
    font-size: 18px;
  }

  .submit-button {
    margin-top: 15px;  /* Add space above the button */
    background: #ff6600;
    color: white;
    border: none;
    padding: 12px 30px;
    border-radius: 8px;
    font-size: 18px;
    cursor: pointer;
    transition: background-color 0.2s;
  }

  .submit-button:hover {
    background: #ff8533;
  }

  .submit-button:disabled {
    background: #666;
    cursor: not-allowed;
  }

  /* Game UI Styles */

  .leaderboards-container {
    position: fixed;
    top: 20px;
    right: 20px;
    display: flex;  /* Always visible */
    flex-direction: column;
    gap: 20px;
  }

  .best-shift-box {
    background: rgba(0, 0, 0, 0.7);
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    min-width: 200px;
  }

  .best-shift-box .score-value {
    color: #ff6600;
    font-size: 24px;
    font-weight: bold;
  }

  .bottom-ui-container {
    position: fixed;
    bottom: 60px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;  /* Always visible */
    flex-direction: row;
    align-items: center;
    justify-content: center;
    gap: 40px;
    width: 80%;
    max-width: 900px;
  }

  .score-box {
    background: rgba(0, 0, 0, 0.7);
    padding: 15px 25px;
    border-radius: 12px;
    text-align: center;
    min-width: 250px;
  }

  .score-label {
    color: #ff6600;
    font-size: 18px;
    text-transform: uppercase;
    margin-bottom: 8px;
  }

  .score-value {
    color: white;
    font-size: 28px;
    font-weight: bold;
  }

  .leaderboard-box {
    background: rgba(0, 0, 0, 0.7);
    padding: 15px;
    border-radius: 10px;
    min-width: 200px;
  }

  .leaderboard-title {
    color: #ff6600;
    font-size: 16px;
    text-transform: uppercase;
    margin-bottom: 10px;
    text-align: center;
  }

  .leaderboard-list {
    color: white;
  }

  .leaderboard-entry {
    display: flex;
    justify-content: space-between;
    margin: 5px 0;
    font-size: 14px;
  }

  .leaderboard-entry .name {
    margin-right: 10px;
  }

  .leaderboard-entry .score {
    color: #ff6600;
  }

  .heat-container {
    position: static;
    width: 350px;
    text-align: center;
    background: rgba(0, 0, 0, 0.7);
    padding: 15px 25px;
    border-radius: 12px;
  }

  .heat-label {
    color: #ff6600;
    font-size: 18px;
    text-transform: uppercase;
    margin-bottom: 8px;
  }

  .heat-bar-wrapper {
    width: 100%;
    height: 24px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 12px;
    overflow: hidden;
    border: 2px solid rgba(255, 255, 255, 0.3);
    margin: 5px 0;
  }

  .heat-bar {
    width: 0%;
    height: 100%;
    background-color: #ffaa00;
    transition: width 0.3s ease-out;
  }

  .countdown-message {
    position: fixed;
    top: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    color: #fff;
    padding: 20px 30px;
    border-radius: 12px;
    font-size: 24px;
    text-align: center;
    z-index: 1003;
    pointer-events: none;
    display: none; /* Hide by default */
  }

  .countdown-message.visible {
    display: block; /* Show when visible class is added */
  }

  .lava-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: red;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
  }

  .join-npc-message {
    background: rgba(0, 0, 0, 0.8);
    border-radius: 12px;
    padding: 12px 20px;
    color: white;
    text-align: center;
    position: relative;
    margin-bottom: 15px;
    pointer-events: none;
  }

  .join-npc-message:after {
    content: '';
    position: absolute;
    bottom: -10px;
    left: 50%;
    transform: translateX(-50%);
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    border-top: 10px solid rgba(0, 0, 0, 0.8);
  }

  .join-npc-message h1 {
    font-size: 24px;
    color: #ff6600;
    margin: 0 0 8px 0;
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
  }

  .join-npc-message p {
    font-size: 16px;
    margin: 0;
    line-height: 1.4;
  }

  .join-npc-message .controls {
    color: #ccc;
    margin-top: 8px;
    font-size: 14px;
  }

  /* Super Charge UI Styles */

  #superChargeUI {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    z-index: 9999;
    pointer-events: none;
    width: 100%;
  }
  
  #superChargePrompt {
    color: white;
    font-size: 20px;
    margin: 0 auto 15px;
    background: rgba(0,0,0,0.7);
    padding: 10px 20px;
    border-radius: 5px;
    border: 2px solid white;
    display: inline-block;
  }
  
  #chargeBar {
    width: 200px;
    height: 10px;
    background: rgba(255,255,255,0.3);
    border: 2px solid white;
    border-radius: 5px;
    overflow: hidden;
    display: none;
    margin: 0 auto;
  }
  
  .charge-fill {
    width: 0%;
    height: 100%;
    background: white;
    border-radius: 3px;
    transition: width 0.1s linear;
  }

  /* Join NPC and Queue Message Styles */

  .queued-message {
    background: rgba(0, 0, 0, 0.8);
    border-radius: 12px;
    padding: 12px 20px;
    color: white;
    text-align: center;
    position: relative;
    margin-bottom: 15px;
    pointer-events: none;
  }

  /* Add highlighting for current player in leaderboard */
  .leaderboard-entry.current-player {
    background: rgba(255, 102, 0, 0.3);
    border-radius: 4px;
    padding: 2px 5px;
  }

  .heat-cluster-notification {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 20px;
    text-align: center;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    background: rgba(0,0,0,0.7);
    padding: 10px 20px;
    border-radius: 5px;
    border: 2px solid white;
    display: inline-block;
  }

  .heat-cluster-notification.active {
    opacity: 1;
  }

  /* Add new styles */
  .partner-selection {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.9);
    padding: 25px;
    border-radius: 12px;
    border: 2px solid #ff6600;
    color: white;
    z-index: 1001;
    pointer-events: auto; /* Ensure clicks work */
  }

  .partner-selection h2 {
    color: #ff6600;
    margin-bottom: 15px;
    text-align: center;
  }

  .partner-option {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    margin: 8px 0;
    background: rgba(255, 102, 0, 0.1);
    border: 2px solid transparent;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    pointer-events: auto; /* Ensure clicks work */
  }

  .partner-option:hover {
    background: rgba(255, 102, 0, 0.2);
    border-color: #ff6600;
  }

  .partner-info {
    position: fixed;
    top: 20px;
    left: 20px;
    background: rgba(0, 0, 0, 0.8);
    padding: 12px 20px;
    border-radius: 8px;
    color: white;
    border: 1px solid #ff6600;
  }

  .selection-status {
    padding: 10px;
    margin-top: 15px;
    border-radius: 5px;
    text-align: center;
    transition: all 0.3s ease;
  }

  .fade-out {
    opacity: 0;
    pointer-events: none;
  }

  .teleport-status {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.8);
    padding: 10px 20px;
    border-radius: 5px;
    color: white;
    opacity: 0;
    transition: opacity 0.3s;
  }

  .teleport-status.success {
    background: rgba(0, 255, 0, 0.8);
  }

  .teleport-status.noPartner,
  .teleport-status.noCharges,
  .teleport-status.invalidPartner {
    background: rgba(255, 0, 0, 0.8);
  }

  .selection-status {
    padding: 10px;
    margin-top: 15px;
    border-radius: 5px;
    text-align: center;
  }

  .selection-status.error {
    background: rgba(255, 0, 0, 0.2);
    color: #ff4444;
  }

  .selection-status.success {
    background: rgba(0, 255, 0, 0.2);
    color: #44ff44;
  }

  .selection-status.pending {
    background: rgba(255, 165, 0, 0.2);
    color: #ffa500;
  }

  .pending-request {
    margin-top: 15px;
    padding: 15px;
    background: rgba(255, 165, 0, 0.1);
    border-radius: 8px;
    text-align: center;
  }

  .request-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 10px;
  }

  .request-buttons button {
    padding: 8px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .accept-btn {
    background: #00aa00;
    color: white;
  }

  .reject-btn {
    background: #aa0000;
    color: white;
  }

  .accept-btn:hover { background: #00cc00; }
  .reject-btn:hover { background: #cc0000; }

  /* Update to match existing game-stat styling */
  .game-stat.teleport-info {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: rgba(0, 0, 0, 0.7);
    padding: 8px 15px;
    border-radius: 5px;
    display: flex;
    align-items: center;
    gap: 8px;
    z-index: 1000; /* Make sure it's visible above other elements */
  }

  .teleport-info .stat-label {
    color: #ff6600;
    font-size: 16px;
    text-transform: uppercase;
  }

  .teleport-info .stat-value {
    color: white;
    font-size: 20px;
    font-weight: bold;
  }

  .stats-container {
    position: fixed;
    top: 20px;
    left: 20px;
    display: flex;
    gap: 10px;
  }

  .game-stat {
    background: rgba(0, 0, 0, 0.7);
    padding: 10px;
    border-radius: 5px;
    text-align: center;
  }

  .game-stat.teleport-info {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: rgba(0, 0, 0, 0.7);
    padding: 8px 15px;
    border-radius: 5px;
    display: flex;
    align-items: center;
    gap: 8px;
    z-index: 1000;
  }

  .stat-label {
    color: #ff6600;
    font-size: 14px;
    text-transform: uppercase;
  }

  .stat-value {
    color: white;
    font-size: 24px;
    font-weight: bold;
  }

  .teleport-info .stat-label {
    font-size: 16px;
  }

  .teleport-info .stat-value {
    font-size: 20px;
  }

  .no-partners {
    text-align: center;
    padding: 20px;
    color: #999;
    font-style: italic;
  }

  /* Add this to ensure the game UI doesn't block partner selection */
  #game-ui {
    pointer-events: none; /* Allow clicks to pass through to partner UI */
  }

  /* But allow clicks on specific game UI elements that need them */
  .game-stat,
  .leaderboard-box,
  .bottom-ui-container {
    pointer-events: auto;
  }

  /* Add after the #superChargeUI styles */
  #teleportMessageUI {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    z-index: 9999;
    pointer-events: none;
    width: 100%;
  }

  #teleportMessagePrompt {
    color: white;
    font-size: 20px;
    margin: 0 auto 15px;
    background: rgba(0,0,0,0.7);
    padding: 10px 20px;
    border-radius: 5px;
    border: 2px solid white;
    display: inline-block;
  }

  .partnership-confirmation {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.8);
    padding: 20px 30px;
    border-radius: 12px;
    color: #44ff44;
    border: 2px solid #44ff44;
    text-align: center;
    z-index: 1002;
    animation: fadeInOut 3s forwards;
  }

  @keyframes fadeInOut {
    0% { opacity: 0; }
    15% { opacity: 1; }
    85% { opacity: 1; }
    100% { opacity: 0; }
  }

  /* Update the center container and panel styles */
  .center-container {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1000;
    pointer-events: none;
    width: 100%;
    height: 100%;  /* Add height to ensure full coverage */
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .center-panel {
    pointer-events: auto;
    position: absolute;  /* This ensures panels stack */
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);  /* Center the panel */
    width: auto;        /* Let content determine width */
    max-width: 500px;   /* But don't get too wide */
  }

  /* Ensure each panel takes up appropriate space */
  .partner-selection {
    width: 90%;         /* Take up most of the width on mobile */
    max-width: 500px;   /* But not too wide on desktop */
  }

  .partnership-confirmation,
  .countdown-message {
    width: auto;        /* Let content determine width */
    min-width: 300px;   /* But ensure minimum readable width */
  }

  /* Keep existing z-index values */
  .partner-selection { z-index: 1001; }
  .partnership-confirmation { z-index: 1002; }
  .countdown-message { z-index: 1003; }

  .partner-list {
    max-height: 300px;  /* Set maximum height */
    overflow-y: auto;   /* Enable vertical scrolling */
    padding-right: 10px; /* Prevent scrollbar from overlapping content */
  }

  /* Style the scrollbar for better appearance */
  .partner-list::-webkit-scrollbar {
    width: 8px;
  }

  .partner-list::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
  }

  .partner-list::-webkit-scrollbar-thumb {
    background: #ff6600;
    border-radius: 4px;
  }

  .partner-list::-webkit-scrollbar-thumb:hover {
    background: #ff8533;
  }

  .teleport-box {
    background: rgba(0, 0, 0, 0.7);
    padding: 15px 25px;
    border-radius: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 60px;
    min-width: 200px;  /* Reduce from 250px to 200px */
  }

  .teleport-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    white-space: nowrap;  /* Prevent text from wrapping */
  }

  .teleport-label {
    color: #ff6600;
    font-size: 16px;
    text-transform: uppercase;
  }

  .teleport-value {
    color: white;
    font-size: 24px;
    font-weight: bold;
  }
</style>

<!-- Add this right after the opening <body> tag or at the start of your HTML section -->

  
  
  
  